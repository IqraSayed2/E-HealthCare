{% extends "base.html" %} 
{% block title %}My Appointments{% endblock %} 
{% block content %}

<div class="p-apt-wrapper">
  <div class="p-apt-container">
    <h1 class="p-apt-title">My Appointments</h1>

    <div class="p-apt-tabs-wrapper">
      <button
        class="p-apt-tab-btn p-apt-tab-active"
        data-p-apt-tab="upcoming"
      >
        Upcoming
      </button>
      <button class="p-apt-tab-btn" data-p-apt-tab="past">Past</button>
      <button class="p-apt-tab-btn" data-p-apt-tab="canceled">
        Canceled
      </button>
    </div>

    <!-- Upcoming Appointments -->
    <div
      class="p-apt-content-section p-apt-content-active"
      data-p-apt-content="upcoming"
    >
      <div class="p-apt-card-list">
        {% for appt in upcoming %}
        <div class="p-apt-appointment-card">
          <div class="p-apt-doctor-avatar">
            {% if appt.doctor.user.doctor_profile.profile_pic %}
              <img src="{{ url_for('static', filename='uploads/' + appt.doctor.user.doctor_profile.profile_pic) }}" alt="Dr. {{ appt.doctor.user.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            {% else %}
              <div class="p-apt-avatar-placeholder">
                {{ appt.doctor.user.name.split() | map('first') | join('') | upper }}
              </div>
            {% endif %}
          </div>
          <div class="p-apt-doctor-info">
            <div class="p-apt-doctor-name">
              Dr. {{ appt.doctor.user.name }}
            </div>
            <div class="p-apt-doctor-specialty">
              {{ appt.doctor.specialization }}
            </div>
            <div class="p-apt-appointment-time">
              {{ appt.formatted_datetime }}
            </div>
          </div>
          <div class="p-apt-action-buttons">
            <a
              href="{{ url_for('patient.consultation', appointment_id=appt.id) }}"
              class="p-apt-action-btn p-apt-btn-primary"
              style="text-decoration: none"
            >
              Consult
            </a>
          </div>
        </div>
        {% endfor %}
      </div>

      {% if not upcoming %}
      <div class="p-apt-empty-state">
        <div class="p-apt-empty-icon">
          <i class="far fa-calendar-plus"></i>
        </div>
        <div class="p-apt-empty-title">No Upcoming Appointments</div>
        <div class="p-apt-empty-description">
          You don't have any upcoming appointments scheduled.
        </div>
        <button class="p-apt-book-button">Book a New Appointment</button>
      </div>
      {% endif %}
    </div>

    <!-- Past Appointments -->
    <div class="p-apt-content-section" data-p-apt-content="past">
      <div class="p-apt-card-list">
        {% for appt in past %}
        <div class="p-apt-appointment-card">
          <div class="p-apt-doctor-avatar">
            {% if appt.doctor.user.doctor_profile.profile_pic %}
              <img src="{{ url_for('static', filename='uploads/' + appt.doctor.user.doctor_profile.profile_pic) }}" alt="Dr. {{ appt.doctor.user.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            {% else %}
              <div class="p-apt-avatar-placeholder">
                {{ appt.doctor.user.name.split() | map('first') | join('') | upper }}
              </div>
            {% endif %}
          </div>
          <div class="p-apt-doctor-info">
            <div class="p-apt-doctor-name">
              Dr. {{ appt.doctor.user.name }}
            </div>
            <div class="p-apt-doctor-specialty">
              {{ appt.doctor.specialization }}
            </div>
            <div class="p-apt-appointment-time">
              {{ appt.formatted_datetime }}
            </div>
          </div>
          <div class="p-apt-action-buttons">
            <button class="p-apt-action-btn p-apt-btn-secondary">
              View Details
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% if not past %}
      <div class="p-apt-empty-state">
        <div class="p-apt-empty-icon">
          <i class="far fa-history"></i>
        </div>
        <div class="p-apt-empty-title">No Past Appointments</div>
        <div class="p-apt-empty-description">
          You haven't completed any appointments yet.
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Canceled Appointments -->
    <div class="p-apt-content-section" data-p-apt-content="canceled">
      <div class="p-apt-card-list">
        {% for appt in canceled %}
        <div class="p-apt-appointment-card">
          <div class="p-apt-doctor-avatar">
            {% if appt.doctor.user.doctor_profile.profile_pic %}
              <img src="{{ url_for('static', filename='uploads/' + appt.doctor.user.doctor_profile.profile_pic) }}" alt="Dr. {{ appt.doctor.user.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            {% else %}
              <div class="p-apt-avatar-placeholder">
                {{ appt.doctor.user.name.split() | map('first') | join('') | upper }}
              </div>
            {% endif %}
          </div>
          <div class="p-apt-doctor-info">
            <div class="p-apt-doctor-name">
              Dr. {{ appt.doctor.user.name }}
            </div>
            <div class="p-apt-doctor-specialty">
              {{ appt.doctor.specialization }}
            </div>
            <div class="p-apt-appointment-time">
              {{ appt.formatted_datetime }}
            </div>
          </div>
          <div class="p-apt-action-buttons">
            <button class="p-apt-action-btn p-apt-btn-primary">Rebook</button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% if not canceled %}
      <div class="p-apt-empty-state">
        <div class="p-apt-empty-icon">
          <i class="far fa-times-circle"></i>
        </div>
        <div class="p-apt-empty-title">No Canceled Appointments</div>
        <div class="p-apt-empty-description">
          You don't have any canceled appointments.
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Tab switching functionality
  const tabButtons = document.querySelectorAll(".p-apt-tab-btn");
  const contentSections = document.querySelectorAll(".p-apt-content-section");

  tabButtons.forEach((button) => {
    button.addEventListener("click", function () {
      const targetTab = this.getAttribute("data-p-apt-tab");

      // Remove active class from all tabs
      tabButtons.forEach((btn) => btn.classList.remove("p-apt-tab-active"));

      // Add active class to clicked tab
      this.classList.add("p-apt-tab-active");

      // Hide all content sections
      contentSections.forEach((section) => {
        section.classList.remove("p-apt-content-active");
      });

      // Show target content
      const targetContent = document.querySelector(
        `[data-p-apt-content="${targetTab}"]`
      );
      if (targetContent) {
        targetContent.classList.add("p-apt-content-active");
      }
    });
  });

  // Add smooth scroll behavior
  document.querySelectorAll(".p-apt-tab-btn").forEach((tab) => {
    tab.addEventListener("click", function () {
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    });
  });
</script>

{% endblock %}
