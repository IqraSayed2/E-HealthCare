{% extends "base.html" %} 
{% block title %}Payment Page{% endblock %}
{% block content %}

<style>
  .payment-wrapper {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    padding: 40px 20px;
  }

  .payment-container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  }

  .payment-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .payment-title {
    font-size: 2.2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 10px;
  }

  .payment-subtitle {
    color: #7f8c8d;
    font-size: 1rem;
  }

  .payment-card {
    background: linear-gradient(135deg, #16a2b8 0%, #138496 100%);
    border-radius: 16px;
    padding: 30px;
    color: white;
    margin-bottom: 30px;
    box-shadow: 0 8px 25px rgba(22, 162, 184, 0.3);
  }

  .payment-doctor-info {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 25px;
  }

  .payment-doctor-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    flex-shrink: 0;
  }

  .payment-doctor-details h4 {
    margin: 0 0 5px 0;
    font-size: 1.4rem;
    font-weight: 600;
  }

  .payment-doctor-details p {
    margin: 0;
    opacity: 0.9;
    font-size: 0.95rem;
  }

  .payment-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
  }

  .payment-detail-item {
    text-align: center;
  }

  .payment-detail-label {
    font-size: 0.85rem;
    opacity: 0.8;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .payment-detail-value {
    font-size: 1.2rem;
    font-weight: 600;
  }

  .payment-amount {
    text-align: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    margin-bottom: 25px;
  }

  .payment-amount-label {
    font-size: 0.9rem;
    opacity: 0.8;
    margin-bottom: 5px;
  }

  .payment-amount-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #fff;
  }

  .payment-pay-btn {
    width: 100%;
    background: white;
    color: #16a2b8;
    border: none;
    border-radius: 12px;
    padding: 16px 30px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .payment-pay-btn:hover {
    background: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
  }

  .payment-pay-btn:active {
    transform: translateY(0);
  }

  .payment-refund-notice {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 1px solid #f39c12;
    border-radius: 12px;
    margin-bottom: 20px;
  }

  .payment-refund-icon {
    font-size: 1.5rem;
    color: #f39c12;
    margin-bottom: 10px;
  }

  .payment-refund-text {
    color: #8b4513;
    font-size: 0.9rem;
    margin: 0;
    line-height: 1.5;
  }

  .payment-security {
    text-align: center;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
  }

  .payment-security-icon {
    font-size: 2rem;
    color: #16a2b8;
    margin-bottom: 10px;
  }

  .payment-security-text {
    color: #6c757d;
    font-size: 0.9rem;
    margin: 0;
  }

  @media (max-width: 768px) {
    .payment-container {
      padding: 25px 20px;
    }

    .payment-title {
      font-size: 1.8rem;
    }

    .payment-doctor-info {
      flex-direction: column;
      text-align: center;
      gap: 15px;
    }

    .payment-details {
      grid-template-columns: 1fr;
      gap: 15px;
    }

    .payment-amount-value {
      font-size: 2rem;
    }
  }
</style>

<div class="payment-wrapper">
  <div class="payment-container">
    <!-- Header -->
    <div class="payment-header">
      <h1 class="payment-title">Complete Your Payment</h1>
      <p class="payment-subtitle">
        Secure payment for your healthcare appointment
      </p>
    </div>

    <!-- Appointment Card -->
    <div class="payment-card">
      <div class="payment-doctor-info">
        <div class="payment-doctor-avatar">
          {% if appointment.doctor.user.doctor_profile.profile_pic %}
          <img
            src="{{ url_for('static', filename='uploads/' + appointment.doctor.user.doctor_profile.profile_pic) }}"
            alt="Dr. {{ appointment.doctor.user.name }}"
            style="
              width: 100%;
              height: 100%;
              object-fit: cover;
              border-radius: 50%;
            "
          />
          {% else %} {{ appointment.doctor.user.name[:2].upper() }} {% endif %}
        </div>
        <div class="payment-doctor-details">
          <h4>Dr. {{ appointment.doctor.user.name }}</h4>
          <p>{{ appointment.doctor.specialization or "General Physician" }}</p>
        </div>
      </div>

      <div class="payment-details">
        <div class="payment-detail-item">
          <div class="payment-detail-label">Date</div>
          <div class="payment-detail-value">{{ appointment.date }}</div>
        </div>
        <div class="payment-detail-item">
          <div class="payment-detail-label">Time</div>
          <div class="payment-detail-value">{{ appointment.time }}</div>
        </div>
      </div>

      <div class="payment-amount">
        <div class="payment-amount-label">Total Amount</div>
        <div class="payment-amount-value">â‚¹{{ appointment.doctor.fees }}</div>
      </div>
    </div>

    <!-- Payment Button -->
    <button id="rzp-button1" class="payment-pay-btn">
      <i class="fas fa-credit-card" style="margin-right: 10px"></i>
      Pay Securely with Razorpay
    </button>

    <!-- Refund Policy Notice -->
    <div class="payment-refund-notice">
      <div class="payment-refund-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <p class="payment-refund-text">
        <strong>Important:</strong> No refunds will be provided once payment is completed, even if you cancel the appointment. Please ensure you want to proceed with this booking.
      </p>
    </div>

    <!-- Security Notice -->
    <div class="payment-security">
      <div class="payment-security-icon">
        <i class="fas fa-shield-alt"></i>
      </div>
      <p class="payment-security-text">
        Your payment is secured with 256-bit SSL encryption and processed
        through Razorpay's secure gateway.
      </p>
    </div>
  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  var options = {
      "key": "{{ razorpay_key }}", // Razorpay Key ID
      "amount": {{ appointment.doctor.fees * 100 }}, // Amount in paise
      "currency": "INR",
      "name": "E-HealthCare",
      "description": "Appointment Payment",
      "order_id": "{{ order_id }}", // Generated order ID from backend
      "handler": function (response){
          // Handle success
          fetch('/patient/payment/success/{{ appointment.id }}', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify(response)
          }).then(() => {
              window.location.href = '/patient/my-appointments';
          });
      },
      "prefill": {
          "name": "{{ current_user.name }}",
          "email": "{{ current_user.email }}"
      },
      "theme": {
          "color": "#16a2b8"
      }
  };
  var rzp1 = new Razorpay(options);
  document.getElementById('rzp-button1').onclick = function(e){
      rzp1.open();
      e.preventDefault();
  }
</script>

{% endblock %}
